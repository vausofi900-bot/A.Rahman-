const schedule = require("node-schedule");

module.exports.config = {
    name: "NamazReminder",
    version: "1.0.0",
    hasPermssion: 0,
    credits: "SaGor",
    description: "à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à¦¯à¦¼ à¦¹à¦²à§‡ à¦¸à¦¬à¦¾à¦‡à¦•à§‡ à¦®à§‡à¦¨à¦¶à¦¨ à¦•à¦°à§‡ à¦¨à¦¾à¦®à¦¾à¦œà§‡ à¦¯à¦¾à¦“à§Ÿà¦¾à¦° à¦¨à¦¿à¦°à§à¦¦à§‡à¦¶ à¦¦à¦¿à¦¬à§‡",
    commandCategory: "AI",
    usages: "namaz auto reminder",
    cooldowns: 5,
};

// --- à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à¦¯à¦¼ à¦¸à§‡à¦Ÿ (à¦¬à¦¾à¦‚à¦²à¦¾à¦¦à§‡à¦¶ à¦¸à¦®à§Ÿ à¦§à¦°à§‡) ---
const prayerTimes = {
    fajr: "05:00",    // à¦«à¦œà¦°
    dhuhr: "12:45",   // à¦¯à§‹à¦¹à¦°
    asr: "03:40",     // à¦†à¦¸à¦°
    maghrib: "18:10", // à¦®à¦¾à¦—à¦°à¦¿à¦¬
    isha: "19:30"     // à¦à¦¶à¦¾
};

// --- à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¿ à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦®à§‡à¦¸à§‡à¦œ ---
const prayerMessages = {
    fajr: [
        "ðŸ•Œ à¦¸à¦¬à¦¾à¦‡à¦•à§‡ à¦«à¦œà¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦®à¦¸à¦œà¦¿à¦¦à§‡ à¦¯à¦¾à¦“à§Ÿà¦¾à¦° à¦†à¦¹à§à¦¬à¦¾à¦¨ à¦•à¦°à¦›à¦¿ ðŸŒ¸",
        "âœ¨ à¦˜à§à¦® à¦­à§‡à¦™à§‡ à¦—à§‡à¦›à§‡? à¦¤à¦¾à¦¹à¦²à§‡ à¦«à¦œà¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡ à¦šà¦²à§‡ à¦¯à¦¾à¦“ à¦‡à¦¨à¦¶à¦¾à¦†à¦²à§à¦²à¦¾à¦¹ ðŸ™",
    ],
    dhuhr: [
        "ðŸ•Œ à¦à¦–à¦¨ à¦¯à§‹à¦¹à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à§Ÿ â° à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤ à¦¹à§‹à¦¨ ðŸŒ¸",
        "â˜€ï¸ à¦¦à§à¦ªà§à¦° à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‡, à¦¯à§‹à¦¹à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦­à§à¦²à§‡ à¦¯à¦¾à¦¬à§‡à¦¨ à¦¨à¦¾ ðŸ™",
    ],
    asr: [
        "ðŸ•Œ à¦†à¦¸à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à§Ÿ à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‡ ðŸŒ¤ï¸ à¦¸à¦¬à¦¾à¦‡ à¦®à¦¸à¦œà¦¿à¦¦à§‡ à¦¯à¦¾à¦¨ âœ¨",
        "ðŸŒ¸ à¦¦à§à¦¨à¦¿à§Ÿà¦¾à¦° à¦•à¦¾à¦œ à¦°à§‡à¦–à§‡ à¦†à¦¸à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§à¦¨ ðŸ•‹",
    ],
    maghrib: [
        "ðŸ•Œ à¦®à¦¾à¦—à¦°à¦¿à¦¬à§‡à¦° à¦†à¦œà¦¾à¦¨ à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‡ ðŸŒ† à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà¦¤à§‡ à¦­à§à¦²à¦¬à§‡à¦¨ à¦¨à¦¾ ðŸ™",
        "âœ¨ à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à¦¨à§‡à¦®à§‡ à¦à¦¸à§‡à¦›à§‡, à¦®à¦¾à¦—à¦°à¦¿à¦¬à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§à¦¨ ðŸ•‹",
    ],
    isha: [
        "ðŸ•Œ à¦‡à¦¶à¦¾à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à§Ÿ à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‡ ðŸŒ™ à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œà§‡ à¦†à¦¸à§à¦¨ âœ¨",
        "ðŸ˜´ à¦˜à§à¦®à¦¾à¦¨à§‹à¦° à¦†à¦—à§‡ à¦‡à¦¶à¦¾à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦†à¦¦à¦¾à§Ÿ à¦•à¦°à§‡ à¦¨à¦¿à¦‡ à¦‡à¦¨à¦¶à¦¾à¦†à¦²à§à¦²à¦¾à¦¹ ðŸŒ¸",
    ]
};

// --- Utility: à¦°â€Œà§à¦¯à¦¾à¦¨à§à¦¡à¦® à¦®à§‡à¦¸à§‡à¦œ ---
function getRandomMessage(list) {
    return list[Math.floor(Math.random() * list.length)];
}

module.exports.handleEvent = async function ({ api, event }) {
    const { threadID } = event;

    // --- à¦¨à¦¾à¦®à¦¾à¦œ Reminder Scheduler ---
    Object.keys(prayerTimes).forEach(prayer => {
        const [hour, minute] = prayerTimes[prayer].split(":");
        schedule.scheduleJob({ hour: parseInt(hour), minute: parseInt(minute) }, async () => {
            try {
                const threadInfo = await api.getThreadInfo(threadID);
                const mentions = threadInfo.participantIDs.map(id => ({ tag: "@everyone", id }));
                
                api.sendMessage(
                    {
                        body: `ðŸ“¢ ${getRandomMessage(prayerMessages[prayer])}\n\n@everyone`,
                        mentions: mentions
                    },
                    threadID
                );
            } catch (e) {
                console.log("Namaz Reminder Error:", e);
            }
        });
    });
};

module.exports.run = async function () {
    return;
};
